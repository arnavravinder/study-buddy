<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Buddy - Coach Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Manrope:wght@400;500;600;700;800&family=Raleway:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/styles/design-system.css">
    <link rel="stylesheet" href="/styles/mentor-dashboard.css">
    <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script type="importmap">
    {
      "imports": {
        "@stream-io/video-client": "./node_modules/@stream-io/video-client/dist/index.es.js",
        "webrtc-adapter": "./node_modules/webrtc-adapter/dist/adapter_no_edge.js",
        "rxjs": "./node_modules/rxjs/dist/esm5/index.js",
        "rxjs/operators": "./node_modules/rxjs/dist/esm5/operators/index.js",
        "@protobuf-ts/runtime": "./node_modules/@protobuf-ts/runtime/build/es2015/index.js",
        "@protobuf-ts/runtime-rpc": "./node_modules/@protobuf-ts/runtime-rpc/build/es2015/index.js",
        "@protobuf-ts/twirp-transport": "./node_modules/@protobuf-ts/twirp-transport/build/es2015/index.js",
        "axios": "./node_modules/axios/dist/esm/axios.js",
        "ua-parser-js": "./node_modules/ua-parser-js/dist/ua-parser.min.js",
        "sdp-transform": "./node_modules/sdp-transform/lib/index.js"
      }
    }
    </script>
</head>

<body>
    <div id="app">
        <nav class="sidebar" v-if="activeTab !== 'chat'">
            <div class="logo">
                <i class="ph-bold ph-chalkboard-teacher"></i>
                <span>Study Buddy</span>
            </div>

            <div class="nav-items">
                <button @click="activeTab = 'overview'" :class="['nav-item', {active: activeTab === 'overview'}]">
                    <i class="ph-bold ph-house"></i>
                    Overview
                </button>

                <button @click="activeTab = 'calendar'" :class="['nav-item', {active: activeTab === 'calendar'}]">
                    <i class="ph-bold ph-calendar-blank"></i>
                    Calendar
                </button>

                <button @click="activeTab = 'students'" :class="['nav-item', {active: activeTab === 'students'}]">
                    <i class="ph-bold ph-student"></i>
                    My Students
                </button>

                <button @click="activeTab = 'subjects'" :class="['nav-item', {active: activeTab === 'subjects'}]">
                    <i class="ph-bold ph-books"></i>
                    Teaching Subjects
                </button>

                <button @click="activeTab = 'chat'" :class="['nav-item', {active: activeTab === 'chat'}]">
                    <i class="ph-bold ph-robot"></i>
                    AI Assistant
                </button>

                <a href="/tools/notes" class="nav-item">
                    <i class="ph-bold ph-notebook"></i>
                    Notes
                </a>
            </div>

            <div class="sidebar-bottom">
                <button class="holiday-toggle" @click="toggleHolidayMode" :class="{active: holidayMode}">
                    <i class="ph-bold ph-sun-horizon"></i>
                    Holiday Mode
                </button>

                <div class="profile">
                    <div class="avatar">
                        <span>AC</span>
                    </div>
                    <div class="profile-info">
                        <div class="name">Arjun Coach</div>
                        <div class="grade">Grade 12 Coach</div>
                    </div>
                </div>
            </div>
        </nav>

        <main class="main-content" :class="{'ai-mode': activeTab === 'chat'}"
            :style="activeTab === 'chat' ? 'margin-left: 0; padding: 0; width: 100vw; height: 100vh;' : ''">
            <div v-if="activeTab === 'overview'" class="overview-tab">
                <div class="header-section">
                    <h1>Welcome back, Arjun! ðŸŽ¯</h1>
                    <p>Ready to inspire and guide your students today?</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ph-bold ph-users-three"></i>
                        </div>
                        <div class="stat-content">
                            <h3>8</h3>
                            <p>Active Students</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ph-bold ph-books"></i>
                        </div>
                        <div class="stat-content">
                            <h3>3</h3>
                            <p>Teaching Subjects</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ph-bold ph-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>24</h3>
                            <p>Sessions This Week</p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="ph-bold ph-star"></i>
                        </div>
                        <div class="stat-content">
                            <h3>4.9</h3>
                            <p>Average Rating</p>
                        </div>
                    </div>
                </div>

                <div class="next-session-card">
                    <div class="session-header">
                        <h2>Next Session</h2>
                        <div class="time-badge">Today, 3:00 PM</div>
                    </div>
                    <div class="session-details">
                        <div class="session-subject">
                            <span class="subject-tag chemistry">Chemistry</span>
                            <h3>Organic Chemistry Basics</h3>
                            <p>Help Anirudh with molecular structures and reactions</p>
                        </div>
                        <div class="student-info">
                            <div class="student-avatar">
                                <span>AK</span>
                            </div>
                            <div class="student-details">
                                <div class="student-name">Anirudh Kumar</div>
                                <div class="student-grade">Grade 10 â€¢ Struggling with organic chemistry</div>
                            </div>
                        </div>
                    </div>
                    <div class="session-actions">
                        <button class="btn-secondary">Reschedule</button>
                        <button class="btn-outline">View Notes</button>
                        <button class="btn-primary" @click="startMeeting">
                            <i class="ph-bold ph-video-camera"></i>
                            Start Meeting
                        </button>
                    </div>
                </div>

                <div class="student-progress-section">
                    <h2>Student Progress Overview</h2>
                    <div class="progress-cards">
                        <div v-for="student in recentStudents" :key="student.id" class="progress-card">
                            <div class="student-header">
                                <div class="student-avatar">
                                    <span>{{ student.initials }}</span>
                                </div>
                                <div class="student-info">
                                    <div class="student-name">{{ student.name }}</div>
                                    <div class="student-subject">{{ student.subject }}</div>
                                </div>
                            </div>
                            <div class="progress-metric">
                                <div class="metric-label">Progress</div>
                                <div class="metric-value">{{ student.progress }}%</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{width: student.progress + '%'}"></div>
                            </div>
                            <div class="student-actions">
                                <button class="action-btn">Message</button>
                                <button class="action-btn">Schedule</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="activeTab === 'calendar'" class="calendar-tab">
                <div class="calendar-header">
                    <h1>Teaching Schedule</h1>
                    <div class="calendar-controls">
                        <button class="calendar-nav" @click="changeMonth(-1)">
                            <i class="ph-bold ph-caret-left"></i>
                        </button>
                        <span class="current-month">{{ currentMonth }}</span>
                        <button class="calendar-nav" @click="changeMonth(1)">
                            <i class="ph-bold ph-caret-right"></i>
                        </button>
                    </div>
                </div>

                <div class="calendar-view">
                    <div class="calendar-grid">
                        <div class="day-header" v-for="day in ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']"
                            :key="day">
                            {{ day }}
                        </div>
                        <div v-for="day in calendarDays" :key="day.date"
                            :class="['calendar-day', {today: day.isToday, 'has-session': day.hasSession}]">
                            <span class="day-number">{{ day.day }}</span>
                            <div v-if="day.hasSession" class="session-indicators">
                                <div class="session-dot" v-for="n in Math.min(day.sessionCount, 3)" :key="n"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="schedule-section">
                    <div class="today-schedule">
                        <h2>Today's Schedule</h2>
                        <div class="session-list">
                            <div v-for="session in todaysSchedule" :key="session.id" class="session-item">
                                <div class="session-time">{{ session.time }}</div>
                                <div class="session-info">
                                    <div class="session-title">{{ session.subject }} with {{ session.student }}</div>
                                    <div class="session-topic">{{ session.topic }}</div>
                                </div>
                                <button class="start-btn" @click="startMeeting">Start</button>
                            </div>
                        </div>
                    </div>

                    <div class="availability">
                        <h2>My Availability</h2>
                        <div class="availability-grid">
                            <div v-for="day in teachingDays" :key="day.name"
                                :class="['day-card', {available: day.available}]">
                                <div class="day-name">{{ day.name }}</div>
                                <div class="day-status">{{ day.available ? 'Available' : 'Unavailable' }}</div>
                                <div v-if="day.available" class="day-hours">{{ day.hours }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="activeTab === 'students'" class="students-tab">
                <div class="students-header">
                    <h1>My Students</h1>
                    <div class="filter-controls">
                        <select v-model="studentFilter" class="filter-select">
                            <option value="all">All Students</option>
                            <option value="chemistry">Chemistry</option>
                            <option value="mathematics">Mathematics</option>
                            <option value="physics">Physics</option>
                        </select>
                    </div>
                </div>

                <div class="students-grid">
                    <div v-for="student in filteredStudents" :key="student.id" class="student-card">
                        <div class="student-header">
                            <div class="student-avatar">
                                <span>{{ student.initials }}</span>
                            </div>
                            <div class="student-basic-info">
                                <h3>{{ student.name }}</h3>
                                <p>{{ student.grade }} â€¢ {{ student.subject }}</p>
                            </div>
                        </div>

                        <div class="student-stats">
                            <div class="stat-group">
                                <div class="stat-item">
                                    <span class="stat-label">Sessions</span>
                                    <span class="stat-value">{{ student.sessions }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Progress</span>
                                    <span class="stat-value">{{ student.progress }}%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Rating</span>
                                    <span class="stat-value">{{ student.rating }}/5</span>
                                </div>
                            </div>
                        </div>

                        <div class="progress-section">
                            <div class="progress-bar">
                                <div class="progress-fill" :style="{width: student.progress + '%'}"></div>
                            </div>
                        </div>

                        <div class="student-details">
                            <div class="detail-item">
                                <strong>Struggles with:</strong> {{ student.struggles }}
                            </div>
                            <div class="detail-item">
                                <strong>Next session:</strong> {{ student.nextSession }}
                            </div>
                        </div>

                        <div class="student-actions">
                            <button class="btn-outline">View Notes</button>
                            <button class="btn-secondary">Message</button>
                            <button class="btn-primary">Schedule Session</button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="activeTab === 'subjects'" class="subjects-tab">
                <h1>My Teaching Subjects</h1>

                <div class="subjects-grid">
                    <div v-for="subject in teachingSubjects" :key="subject.name" class="subject-card">
                        <div class="subject-header">
                            <div class="subject-icon">
                                <i :class="getSubjectIcon(subject.name)"></i>
                            </div>
                            <h3>{{ subject.name }}</h3>
                        </div>

                        <div class="subject-metrics">
                            <div class="metric">
                                <span class="metric-label">Students</span>
                                <span class="metric-value">{{ subject.students }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Sessions/Week</span>
                                <span class="metric-value">{{ subject.sessionsPerWeek }}</span>
                            </div>
                            <div class="metric">
                                <span class="metric-label">Avg Rating</span>
                                <span class="metric-value">{{ subject.rating }}/5</span>
                            </div>
                        </div>

                        <div class="confidence-section">
                            <div class="confidence-label">
                                <span>My Confidence</span>
                                <span>{{ subject.confidence }}/5</span>
                            </div>
                            <div class="confidence-bar">
                                <div class="confidence-fill" :style="{width: (subject.confidence / 5) * 100 + '%'}">
                                </div>
                            </div>
                        </div>

                        <div class="topics-section">
                            <h4>Topics I Teach</h4>
                            <div class="topics-list">
                                <span v-for="topic in subject.topics" :key="topic" class="topic-tag">{{ topic }}</span>
                            </div>
                        </div>

                        <div class="subject-actions">
                            <button class="btn-outline">View Students</button>
                            <button class="btn-primary">Manage Topics</button>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="activeTab === 'chat'" class="ai-assistant-page"
                style="height: 100vh; display: flex; background: var(--bg-card);">
                <!-- History Sidebar -->
                <div class="ai-history"
                    style="width: 260px; background: var(--bg-body); border-right: 1px solid var(--border-color); display: flex; flex-direction: column;">
                    <div
                        style="padding: 1.5rem 1rem; border-bottom: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 0.5rem;">
                        <button @click="activeTab = 'overview'"
                            style="align-self: flex-start; background: transparent; border: none; font-weight: 600; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; margin-bottom: 0.5rem;">
                            <i class="ph-bold ph-arrow-left"></i> Back to Dashboard
                        </button>
                        <button @click="startNewChat"
                            style="width: 100%; border: 1px dashed var(--border-color); background: transparent; padding: 0.75rem; border-radius: 8px; color: var(--text-primary); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem; transition: all 0.2s;">
                            <i class="ph-bold ph-plus"></i> New Chat
                        </button>
                    </div>
                    <div class="history-list" style="flex: 1; overflow-y: auto; padding: 1rem;">
                        <div
                            style="font-size: 0.8rem; font-weight: 700; color: var(--text-secondary); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">
                            Recent</div>
                        <div v-for="chat in aiHistory" :key="chat.id" class="history-item"
                            style="padding: 0.75rem; border-radius: 8px; cursor: pointer; color: var(--text-primary); margin-bottom: 0.5rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 0.5rem; transition: background 0.2s;">
                            <i class="ph-regular ph-chat-circle"></i>
                            <span style="font-size: 0.9rem;">{{ chat.title }}</span>
                        </div>
                    </div>
                </div>

                <!-- Chat Area -->
                <div class="ai-chat-main" style="flex: 1; display: flex; flex-direction: column; position: relative;">
                    <!-- Empty State / Welcome -->
                    <div v-if="aiMessages.length === 0"
                        style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2rem; color: var(--text-primary);">
                        <div
                            style="width: 64px; height: 64px; background: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; box-shadow: 0 4px 15px rgba(20, 184, 166, 0.4);">
                            <i class="ph-fill ph-chalkboard-teacher"></i>
                        </div>
                        <h2 style="font-size: 1.75rem; font-weight: 700;">Teaching Assistant AI</h2>
                        <p style="color: var(--text-secondary); margin-top: -1rem;">Powered by OpenAI</p>

                        <div class="suggestions"
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width: 100%; max-width: 600px; padding: 0 2rem;">
                            <button @click="sendSuggestion('Create a lesson plan for Thermodynamics')"
                                class="suggestion-chip"
                                style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-body); cursor: pointer; text-align: left; transition: all 0.2s;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">Lesson Plan</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Structure a 45 min class
                                </div>
                            </button>
                            <button @click="sendSuggestion('Generate 5 quiz questions for Algebra')"
                                class="suggestion-chip"
                                style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-body); cursor: pointer; text-align: left; transition: all 0.2s;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">Quiz Generator</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Create practice problems
                                </div>
                            </button>
                            <button @click="sendSuggestion('How to explain gravity to a 10 year old?')"
                                class="suggestion-chip"
                                style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-body); cursor: pointer; text-align: left; transition: all 0.2s;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">Simplification Strategy</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Pedagogical advice</div>
                            </button>
                            <button @click="sendSuggestion('Email template for parent update')" class="suggestion-chip"
                                style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 12px; background: var(--bg-body); cursor: pointer; text-align: left; transition: all 0.2s;">
                                <div style="font-weight: 600; margin-bottom: 0.25rem;">Communication</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">Draft professional emails
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Messages -->
                    <div v-else class="ai-messages-scroll" ref="aiChatScroll"
                        style="flex: 1; overflow-y: auto; padding: 2rem; display: flex; flex-direction: column; gap: 1.5rem;">
                        <div v-for="msg in aiMessages" :key="msg.id"
                            :style="{alignSelf: msg.sender === 'user' ? 'flex-end' : 'flex-start', maxWidth: '70%'}">
                            <div :style="{
                                    padding: '1rem 1.5rem', 
                                    borderRadius: msg.sender === 'user' ? '20px 20px 0 20px' : '20px 20px 20px 0',
                                    background: msg.sender === 'user' ? 'var(--primary-color)' : 'var(--bg-body)',
                                    color: msg.sender === 'user' ? 'white' : 'var(--text-primary)',
                                    boxShadow: 'var(--shadow-card)',
                                    lineHeight: '1.6'
                                }">
                                <div v-if="msg.sender === 'ai'"
                                    style="display: flex; gap: 0.75rem; margin-bottom: 0.5rem; align-items: center; font-size: 0.85rem; font-weight: 700; opacity: 0.7;">
                                    <i class="ph-fill ph-chalkboard-teacher"></i> Assistant
                                </div>
                                <div v-html="msg.content"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div style="padding: 1.5rem 2rem; background: var(--bg-card);">
                        <div style="position: relative; max-width: 800px; margin: 0 auto;">
                            <textarea v-model="aiInput" @keyup.enter.prevent="sendAiMessage"
                                placeholder="Ask for teaching advice, resources, or lesson plans..."
                                style="width: 100%; padding: 1rem 3rem 1rem 1.5rem; border: 1px solid var(--border-color); border-radius: 16px; background: var(--bg-body); color: var(--text-primary); resize: none; outline: none; height: 60px; font-family: inherit; box-shadow: var(--shadow-card);"></textarea>
                            <button @click="sendAiMessage"
                                style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: var(--primary-color); color: white; width: 32px; height: 32px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="ph-bold ph-paper-plane-right"></i>
                            </button>
                        </div>
                        <div
                            style="text-align: center; font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.75rem;">
                            AI assistance for educators. Verify content before use.
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div v-if="showMeetingModal" class="meeting-modal" @click.self="leaveMeeting">
            <div class="modal-content modal-video">
                <button @click="leaveMeeting" class="modal-close-btn">
                    <i class="ph-bold ph-x"></i>
                </button>
                <div class="meeting-header">
                    <h2>Chemistry with Anirudh Kumar</h2>
                    <div class="meeting-status">
                        <span class="status-indicator"></span>
                        <span>{{ callStatus }}</span>
                    </div>
                </div>

                <div id="video-container" class="video-container">
                    <div id="remote-video" class="remote-video"></div>
                    <div id="local-video" class="local-video"></div>
                </div>

                <div class="video-controls">
                    <button @click="toggleAudio" :class="['control-btn', {active: isAudioEnabled}]">
                        <i :class="isAudioEnabled ? 'ph-bold ph-microphone' : 'ph-bold ph-microphone-slash'"></i>
                    </button>
                    <button @click="toggleVideo" :class="['control-btn', {active: isVideoEnabled}]">
                        <i :class="isVideoEnabled ? 'ph-bold ph-video-camera' : 'ph-bold ph-video-camera-slash'"></i>
                    </button>
                    <button @click="toggleScreenShare" :class="['control-btn', {active: isScreenSharing}]">
                        <i class="ph-bold ph-monitor"></i>
                    </button>
                    <button @click="leaveMeeting" class="control-btn danger">
                        <i class="ph-bold ph-phone-disconnect"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="/scripts/mentor-dashboard.js" type="module"></script>
</body>

</html>