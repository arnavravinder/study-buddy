<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Buddy</title>
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <script src="https://unpkg.com/@phosphor-icons/web@2.0.3"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <link rel="stylesheet" href="/styles/landing.css">
    <link rel="stylesheet" href="/styles/login.css">

    <style>
        #main-container {
            display: none;
            opacity: 0;
            transition: opacity 1s ease;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }

        #main-container.active {
            display: block;
            opacity: 1;
        }
    </style>
</head>

<body>

    <div class="transition-overlay"></div>

    <div class="container" id="landing-container">
        <header class="header">
            <div class="logo">
                Study Buddy
            </div>

            <nav class="nav-links">
            </nav>
        </header>

        <main class="hero">
            <h1 class="headline">
                Unlock your academic
                <span class="highlight-container">
                    potential.
                    <svg class="flourish-underline" viewBox="0 0 200 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2.00025 7.00001C30.5003 3.00001 126 -3.5 198 4.5" stroke="white" stroke-width="3"
                            stroke-linecap="round" />
                    </svg>
                </span>
            </h1>
            <p class="subheadline">
                Experience a new era of learning. Connect with expert mentors and master every subject in a community
                dedicated to your success.
            </p>

            <div class="cta-wrapper">
                <a href="#" class="cta-arrow" id="ctaBtn">
                    <i class="ph-fill ph-paper-plane-right"></i>
                </a>
                <span class="cta-text">Get Started</span>
            </div>
        </main>

        <div></div>
    </div>

    <div class="login-container" id="main-container">

        <div class="header" style="justify-content: center; animation: none; opacity: 1;">
            <div class="logo-large">
                Study Buddy
            </div>
        </div>

        <div id="login-view">
            <h1 class="intro-text">Welcome back</h1>

            <button id="google-login-btn" class="login-btn">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="20"
                    height="20">
                Continue with Google
            </button>

            <div class="divider">or</div>

            <button class="login-btn" style="color: #666; justify-content: center; gap: 8px;">
                <i class="ph-bold ph-envelope-simple" style="font-size: 1.2rem;"></i>
                Continue with Email
            </button>
        </div>

        <div id="role-selection">
            <h2 class="role-header">How do you want to use Study Buddy?</h2>

            <div class="role-options">
                <div class="role-btn" onclick="selectRole('mentee')">
                    <div class="role-btn-icon"><i class="ph-bold ph-student"></i></div>
                    <span class="role-btn-text">I want to be a Student</span>
                </div>

                <div class="role-btn" onclick="selectRole('mentor')">
                    <div class="role-btn-icon"><i class="ph-bold ph-chalkboard-teacher"></i></div>
                    <span class="role-btn-text">I want to be a Mentor</span>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { signInWithGoogle, handleRoleSelection } from '/scripts/auth.js';

        const ctaBtn = document.getElementById('ctaBtn');
        const loginContainer = document.getElementById('main-container');
        const landingContainer = document.getElementById('landing-container');
        const overlay = document.querySelector('.transition-overlay');
        const landingText = document.querySelector('.hero');

        const loginView = document.getElementById('login-view');
        const roleSelection = document.getElementById('role-selection');
        const googleBtn = document.getElementById('google-login-btn');

        window.selectRole = async (role) => {
            await handleRoleSelection(role);
        };

        window.showRoleSelection = () => {
            loginView.style.display = 'none';
            roleSelection.style.display = 'block';
        };

        if (googleBtn) {
            googleBtn.addEventListener('click', async () => {
                googleBtn.classList.add('loading');
                const originalWidth = googleBtn.offsetWidth;
                googleBtn.style.width = originalWidth + 'px';
                googleBtn.innerHTML = '<span class="loader"></span>';

                try {
                    await signInWithGoogle();
                } catch (error) {
                    console.error(error);
                    googleBtn.classList.remove('loading');
                    googleBtn.style.width = '100%';
                    googleBtn.innerHTML = '<img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" width="20" height="20"> Continue with Google';
                }
            });
        }


        if (ctaBtn) {
            ctaBtn.addEventListener('click', function (e) {
                e.preventDefault();
                console.log('✈️ Starting Animation!');

                const icon = ctaBtn.querySelector('i');
                const btnRect = ctaBtn.getBoundingClientRect();
                const btnCenterX = btnRect.left + btnRect.width / 2;
                const btnCenterY = btnRect.top + btnRect.height / 2;

                icon.style.position = 'absolute';

                const tl = gsap.timeline();

                const orbitRadius = 145;
                const orbitDuration = 1.2;

                tl.to(icon, {
                    duration: orbitDuration,
                    ease: 'linear',
                    onUpdate: function () {
                        const progress = this.progress();
                        const angle = progress * Math.PI * 2;
                        const x = Math.sin(angle) * orbitRadius;
                        const y = -Math.cos(angle) * orbitRadius;
                        const rotation = (angle * 180 / Math.PI);
                        gsap.set(icon, { x: x, y: y, rotation: rotation });
                    }
                });

                const targetX = window.innerWidth - btnCenterX + 50;
                const targetY = -btnCenterY - 50;

                tl.addLabel('flight');

                tl.to(icon, {
                    x: targetX,
                    y: targetY,
                    scale: 0.5,
                    duration: 1.3,
                    ease: 'power2.in'
                }, 'flight');

                tl.to(landingText.querySelectorAll('.headline, .subheadline, .cta-text'), {
                    opacity: 0,
                    duration: 1,
                    ease: 'power2.out'
                }, 'flight-=0.3');

                tl.to(ctaBtn, {
                    opacity: 0,
                    duration: 0.3
                }, 'flight+=1.3');

                if (overlay) {
                    tl.to(overlay, {
                        opacity: 1,
                        duration: 0.8,
                        ease: 'power2.inOut'
                    }, 'flight-=0.1');
                }

                tl.add(() => {
                    icon.style.opacity = '0';
                    console.log('✨ Revealing Login Container');
                    landingContainer.style.display = 'none';
                    ctaBtn.style.display = 'none';
                    loginContainer.style.display = 'block';
                });

                tl.to(loginContainer, {
                    opacity: 1,
                    duration: 0.6,
                    ease: 'power2.out'
                });
            });
        }
    </script>

    <svg style="position: absolute; width: 0; height: 0; pointer-events: none;">
        <filter id="frosted" x="-20%" y="-20%" width="140%" height="140%">
            <feTurbulence type="turbulence" baseFrequency="0.01" numOctaves="3" result="noise" seed="5" />
            <feGaussianBlur in="noise" stdDeviation="2" result="blurredNoise" />
            <feDisplacementMap in="SourceGraphic" in2="blurredNoise" scale="30" xChannelSelector="R"
                yChannelSelector="G" />
        </filter>
    </svg>
</body>

</html>