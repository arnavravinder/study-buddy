<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | Study Buddy</title>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/mentor-dashboard.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/light.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <style>
        [v-cloak] {
            display: none;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <div class="dashboard-layout">
            <div class="sidebar">
                <div class="logo">
                    <span>Study Buddy</span>
                </div>
                <div class="nav-menu">
                    <div class="nav-item" :class="{active: activeTab === 'dashboard'}" @click="activeTab = 'dashboard'">
                        <i class="ph ph-squares-four"></i>
                        <span>Overview</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'mentors'}" @click="activeTab = 'mentors'">
                        <i class="ph ph-users"></i>
                        <span>My Mentors</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'schedule'}" @click="activeTab = 'schedule'">
                        <i class="ph ph-calendar-blank"></i>
                        <span>Schedule</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'messages'}" @click="activeTab = 'messages'">
                        <i class="ph ph-chat-circle-dots"></i>
                        <span>Messages</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'whiteboard'}"
                        @click="activeTab = 'whiteboard'">
                        <i class="ph ph-chalkboard-teacher"></i>
                        <span>Whiteboard</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'sessions'}" @click="activeTab = 'sessions'">
                        <i class="ph ph-video-camera"></i>
                        <span>Your Sessions</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'ai'}" @click="activeTab = 'ai'">
                        <i class="ph ph-sparkle"></i>
                        <span>AI Assistant</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'notes'}" @click="activeTab = 'notes'">
                        <i class="ph ph-notebook"></i>
                        <span>Study Notes</span>
                    </div>
                    <div class="nav-item" :class="{active: activeTab === 'settings'}" @click="activeTab = 'settings'">
                        <i class="ph ph-gear"></i>
                        <span>Settings</span>
                    </div>
                </div>
                <div class="user-mini-profile">
                    <div class="avatar-circle">{{ userInitials }}</div>
                    <div class="info" style="display: flex; flex-direction: column;">
                        <span style="font-weight: 700; font-size: 0.9rem;">{{ currentUser?.displayName ||
                            currentUser?.name || 'Student' }}</span>
                        <span style="font-size: 0.8rem; color: var(--text-secondary);">Student</span>
                    </div>
                </div>
            </div>
            <main class="main-content">
                <div v-if="activeTab === 'dashboard'">
                    <div class="header-area">
                        <div>
                            <div class="header-date">{{ currentDate }}</div>
                            <h1 class="header-title">Good {{ greeting }}!</h1>
                        </div>
                        <button class="btn" @click="openBookingModal()">
                            <i class="ph ph-plus" style="margin-right: 0.5rem;"></i> Book Session
                        </button>
                    </div>
                    <div class="bento-grid">
                        <div class="bento-card">
                            <div class="card-icon"><i class="ph ph-book-open"></i></div>
                            <div>
                                <div class="card-value">{{ assignedMentors.length }}</div>
                                <div class="card-label">My Mentors</div>
                            </div>
                        </div>
                        <div class="bento-card">
                            <div class="card-icon"><i class="ph ph-clock"></i></div>
                            <div>
                                <div class="card-value">{{ todaysSessions.length }}</div>
                                <div class="card-label">Sessions Today</div>
                            </div>
                        </div>
                        <div class="bento-card">
                            <div class="card-icon"><i class="ph ph-check-circle"></i></div>
                            <div>
                                <div class="card-value">{{ assignedQuizzes.length }}</div>
                                <div class="card-label">Pending Quizzes</div>
                            </div>
                        </div>
                    </div>
                    <div class="content-section" style="margin-bottom: 2rem;">
                        <div class="section-label">Today's Sessions</div>
                        <div class="floating-list">
                            <div v-for="session in todaysSessions" :key="session.id" class="list-item">
                                <div class="item-left">
                                    <div class="item-icon">
                                        <i class="ph-fill ph-video-camera"></i>
                                    </div>
                                    <div>
                                        <div class="item-primary-text">{{ formatSessionTime(session.startTime) }}</div>
                                        <div class="item-secondary-text">{{ session.subject }}</div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 2rem;">
                                    <div class="item-primary-text">{{ session.mentorName }}</div>
                                    <span class="status-badge status-upcoming">{{ session.status || 'Upcoming' }}</span>
                                    <button class="icon-btn" @click="joinSession(session)">
                                        <i class="ph ph-caret-right"></i>
                                    </button>
                                </div>
                            </div>
                            <div v-if="todaysSessions.length === 0"
                                style="text-align: center; color: #999; padding: 2rem;">
                                <i class="ph ph-calendar-x"
                                    style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                                No sessions scheduled for today
                            </div>
                        </div>
                    </div>
                    <div v-if="assignedQuizzes.length > 0" class="content-section">
                        <div class="section-label">Assigned Quizzes</div>
                        <div class="floating-list">
                            <div v-for="quiz in assignedQuizzes" :key="quiz.id" class="list-item">
                                <div class="item-left">
                                    <div class="item-icon" style="background: #fef3c7;">
                                        <i class="ph ph-exam" style="color: #d97706;"></i>
                                    </div>
                                    <div>
                                        <div class="item-primary-text">{{ quiz.title }}</div>
                                        <div class="item-secondary-text">{{ quiz.questions?.length || 0 }} questions •
                                            From {{ quiz.mentorName }}</div>
                                    </div>
                                </div>
                                <button class="btn" @click="startAssignedQuiz(quiz)" style="padding: 0.5rem 1.25rem;">
                                    Start Quiz
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'mentors'">
                    <div class="header-area">
                        <div>
                            <div class="header-date">Learning Network</div>
                            <h1 class="header-title">My Mentors</h1>
                        </div>
                    </div>
                    <div class="student-grid-view">
                        <div v-for="mentor in assignedMentors" :key="mentor.id" class="student-card-modern">
                            <div class="avatar-circle">
                                {{ getMentorInitials(mentor) }}
                            </div>
                            <h3>{{ mentor.displayName || mentor.name }}</h3>
                            <p style="margin-bottom: 1rem;">{{ mentor.subjects?.join(', ') || mentor.subject ||
                                'General' }}</p>
                            <div style="display: flex; gap: 0.5rem; width: 100%;">
                                <button class="btn-outline" @click="viewMentorAvailability(mentor)"
                                    style="flex: 1;">Schedule</button>
                                <button class="btn" @click="startStrictChat(mentor)" style="flex: 1;">Message</button>
                            </div>
                        </div>
                        <div v-if="assignedMentors.length === 0"
                            style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #999;">
                            <i class="ph ph-users" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                            <p>No mentors assigned yet. Contact admin for mentor assignment.</p>
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'schedule'">
                    <div class="header-area">
                        <div>
                            <h1 class="header-title">My Schedule</h1>
                            <p style="color: #666; margin-top: 0.5rem;">View and manage your upcoming sessions</p>
                        </div>
                        <button class="btn" @click="openBookingModal()">
                            <i class="ph ph-plus" style="margin-right: 0.5rem;"></i> Book Session
                        </button>
                    </div>
                    <div v-if="pendingBookings.length > 0" style="margin-bottom: 2rem;">
                        <div class="section-label">Pending Requests</div>
                        <div v-for="booking in pendingBookings" :key="booking.id" class="booking-card">
                            <div class="booking-info">
                                <h4>{{ booking.subject }}</h4>
                                <p>{{ booking.mentorName }} • {{ formatSessionDate(booking.date) }} at {{ booking.time
                                    }}</p>
                            </div>
                            <span
                                style="background: #fef3c7; color: #92400e; padding: 0.4rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">
                                Pending
                            </span>
                        </div>
                    </div>
                    <div class="section-label">Upcoming Sessions</div>
                    <div class="floating-list">
                        <div v-for="session in allSessions" :key="session.id" class="list-item">
                            <div class="item-left">
                                <div class="item-icon">
                                    <i class="ph ph-calendar"></i>
                                </div>
                                <div>
                                    <div class="item-primary-text">{{ formatSessionDate(session.date) }} • {{
                                        formatSessionTime(session.startTime) }}</div>
                                    <div class="item-secondary-text">{{ session.subject }}</div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div class="item-primary-text" style="margin-right: 1rem;">{{ session.mentorName }}
                                </div>
                                <button class="btn" @click="joinSession(session)"
                                    style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Join</button>
                            </div>
                        </div>
                        <div v-if="allSessions.length === 0" style="text-align: center; padding: 2rem; color: #999;">
                            No upcoming sessions. Book a session with your mentor!
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'ai'" class="ai-tab-container">
                    <div
                        style="background: #fcfcfc; border-right: 1px solid rgba(0,0,0,0.05); display: flex; flex-direction: column;">
                        <div style="padding: 1.25rem; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.75rem;">
                                <button @click="aiSidebarTab = 'chats'"
                                    :style="{background: aiSidebarTab === 'chats' ? '#222' : 'transparent', color: aiSidebarTab === 'chats' ? 'white' : '#666'}"
                                    style="flex: 1; padding: 0.5rem; border-radius: 8px; border: none; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                    <i class="ph ph-chats-circle"></i> Chats
                                </button>
                                <button @click="aiSidebarTab = 'quizzes'"
                                    :style="{background: aiSidebarTab === 'quizzes' ? '#222' : 'transparent', color: aiSidebarTab === 'quizzes' ? 'white' : '#666'}"
                                    style="flex: 1; padding: 0.5rem; border-radius: 8px; border: none; font-size: 0.85rem; font-weight: 500; cursor: pointer; transition: all 0.2s;">
                                    <i class="ph ph-exam"></i> Quizzes
                                </button>
                            </div>
                            <button v-if="aiSidebarTab === 'chats'" class="btn-outline" @click="startNewChat"
                                style="width: 100%; padding: 0.5rem; border-radius: 8px; font-size: 0.85rem;">
                                <i class="ph ph-plus"></i> New Chat
                            </button>
                        </div>
                        <div v-if="aiSidebarTab === 'chats'" style="flex: 1; overflow-y: auto; padding: 1rem;">
                            <div v-if="chatHistory.length === 0"
                                style="text-align: center; color: #999; font-size: 0.9rem; margin-top: 2rem;">No chats
                                yet</div>
                            <div v-for="chat in chatHistory" :key="chat.id" @click="loadChat(chat)"
                                style="padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.9rem; color: #444; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: background 0.2s; margin-bottom: 0.25rem;"
                                onmouseover="this.style.background='#eee'"
                                onmouseout="this.style.background='transparent'">
                                <i class="ph-regular ph-chat-circle"
                                    style="margin-right: 0.5rem; vertical-align: middle;"></i>
                                {{ chat.title || 'Untitled Chat' }}
                            </div>
                        </div>
                        <div v-if="aiSidebarTab === 'quizzes'" style="flex: 1; overflow-y: auto; padding: 1rem;">
                            <div v-if="assignedQuizzes.length > 0" style="margin-bottom: 1rem;">
                                <div
                                    style="font-size: 0.75rem; text-transform: uppercase; color: #999; margin-bottom: 0.5rem; padding: 0 0.5rem;">
                                    Assigned</div>
                                <div v-for="quiz in assignedQuizzes" :key="quiz.id" @click="startAssignedQuiz(quiz)"
                                    style="padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.9rem; color: #444; cursor: pointer; transition: background 0.2s; margin-bottom: 0.5rem; background: #fef3c7; border: 1px solid #fcd34d;">
                                    <div style="font-weight: 500; margin-bottom: 0.25rem;">{{ quiz.title }}</div>
                                    <div style="font-size: 0.8rem; color: #92400e;">{{ quiz.questions?.length || 0 }}
                                        questions</div>
                                </div>
                            </div>
                            <div v-if="savedQuizzes.length === 0 && assignedQuizzes.length === 0"
                                style="text-align: center; color: #999; font-size: 0.9rem; margin-top: 2rem;">No quizzes
                                yet</div>
                            <div v-for="quiz in savedQuizzes" :key="quiz.id" @click="loadSavedQuiz(quiz)"
                                style="padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.9rem; color: #444; cursor: pointer; transition: background 0.2s; margin-bottom: 0.5rem; background: white; border: 1px solid #eee;"
                                onmouseover="this.style.borderColor='#222'" onmouseout="this.style.borderColor='#eee'">
                                <div style="font-weight: 500; margin-bottom: 0.25rem;">{{ quiz.title }}</div>
                                <div style="font-size: 0.8rem; color: #999;">{{ quiz.questions?.length || 0 }} questions
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-chat-area">
                        <div v-if="aiSidebarTab === 'chats' && messages.length === 0 && !isAiThinking"
                            style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; overflow-y: auto;">
                            <h1 style="font-family: 'Outfit'; font-size: 2.5rem; margin-bottom: 2rem; color: #222;">
                                How can I help you study?</h1>
                            <div style="width: 100%; max-width: 600px; position: relative;">
                                <div
                                    style="display: flex; background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 0.75rem 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: border-color 0.2s; align-items: flex-start;">
                                    <textarea v-model="aiInput" @keydown.enter.prevent="sendAiMessage"
                                        placeholder="Ask about homework, concepts, or schedule..."
                                        style="flex: 1; border: none; outline: none; resize: none; font-size: 1.1rem; font-family: 'DM Sans'; min-height: 28px; max-height: 200px; overflow-y: auto; margin-top: 2px;"
                                        rows="1"></textarea>
                                    <button class="chat-action-btn" @click="sendAiMessage"
                                        :disabled="isAiThinking || !aiInput.trim()">
                                        <i class="ph-fill ph-arrow-right" style="font-size: 1.2rem;"></i>
                                    </button>
                                </div>
                                <div
                                    style="display: flex; gap: 0.75rem; margin-top: 1rem; justify-content: center; flex-wrap: wrap;">
                                    <button class="chip" @click="aiInput='Summarize my physics notes'; sendAiMessage()">
                                        <i class="ph ph-atom"></i> Physics Summary
                                    </button>
                                    <button class="chip" @click="aiInput='Test me on Calculus'; sendAiMessage()">
                                        <i class="ph ph-function"></i> Calculus Quiz
                                    </button>
                                    <button class="chip"
                                        @click="aiInput='Explain The Great Gatsby themes'; sendAiMessage()">
                                        <i class="ph ph-book-open"></i> Literature Help
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div v-if="aiSidebarTab === 'quizzes' && !activeQuiz"
                            style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                            <div style="flex: 1; overflow-y: auto; padding: 2rem; padding-bottom: 120px;"
                                ref="quizChatWindow">
                                <div v-if="quizMessages.length === 0" style="max-width: 700px; margin: 0 auto;">
                                    <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                                        <div style="flex: 1;">
                                            <div
                                                style="background: #f5f5f5; padding: 1rem; border-radius: 12px; line-height: 1.6;">
                                                Hi! I'm here to help you study. <strong>What topic should we quiz
                                                    on?</strong>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div v-for="(msg, index) in quizMessages" :key="index"
                                    style="max-width: 700px; margin: 0 auto 1.5rem;">
                                    <div v-if="msg.role === 'user'"
                                        style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                                        <div
                                            style="background: #222; color: white; padding: 0.75rem 1rem; border-radius: 12px; max-width: 80%;">
                                            {{ msg.content }}
                                        </div>
                                    </div>
                                    <div v-if="msg.role === 'assistant'" style="display: flex; gap: 1rem;">
                                        <div style="flex: 1;">
                                            <div style="background: #f5f5f5; padding: 1rem; border-radius: 12px; line-height: 1.6;"
                                                v-html="msg.content"></div>
                                            <div v-if="msg.buttons"
                                                style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem;">
                                                <button v-for="btn in msg.buttons" :key="btn"
                                                    @click="handleQuizButton(btn)"
                                                    style="padding: 0.5rem 1rem; background: white; border: 1px solid #222; border-radius: 8px; cursor: pointer;">
                                                    {{ btn }}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div
                                style="position: absolute; bottom: 0; left: 0; width: 100%; background: white; padding: 2rem; border-top: 1px solid #eee;">
                                <div style="max-width: 700px; margin: 0 auto; display: flex; gap: 0.5rem;">
                                    <input v-model="quizInput" @keydown.enter="sendQuizMessage"
                                        placeholder="Type your response..."
                                        style="flex: 1; padding: 0.75rem; border: 1px solid #ddd; border-radius: 8px; outline: none;">
                                    <button @click="sendQuizMessage" class="btn"
                                        style="padding: 0 1.5rem;">Send</button>
                                </div>
                            </div>
                        </div>
                        <div v-if="activeQuiz" style="flex: 1; overflow-y: auto; padding: 2rem;">
                            <div style="max-width: 700px; margin: 0 auto;">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                                    <h2>{{ activeQuiz.title }}</h2>
                                    <button @click="finishQuiz" class="btn-outline">Finish Quiz</button>
                                </div>
                                <div
                                    style="background: #e5e7eb; border-radius: 10px; height: 8px; margin-bottom: 2rem; overflow: hidden;">
                                    <div :style="{width: quizProgress + '%'}"
                                        style="background: #222; height: 100%; transition: width 0.3s;"></div>
                                </div>
                                <div v-for="(q, idx) in activeQuiz.questions" :key="idx"
                                    style="background: white; border: 1px solid #e5e7eb; border-radius: 16px; padding: 1.5rem; margin-bottom: 1rem;"
                                    :style="{borderColor: q.answered ? (q.correct ? '#22c55e' : '#ef4444') : '#e5e7eb'}">
                                    <h4 style="margin-bottom: 1rem;">{{ idx + 1 }}. {{ q.question }}</h4>
                                    <div v-if="q.type === 'mcq' || (!q.type && q.options)"
                                        style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <button v-for="opt in q.options" :key="opt" @click="answerQuestion(idx, opt)"
                                            :disabled="q.answered" :style="getOptionStyle(q, opt)"
                                            style="padding: 0.75rem; border-radius: 8px; text-align: left; border: 1px solid #eee; cursor: pointer;">
                                            {{ opt }}
                                        </button>
                                    </div>
                                    <div v-if="q.type === 'truefalse'" style="display: flex; gap: 0.5rem;">
                                        <button @click="answerQuestion(idx, 'True')" :disabled="q.answered"
                                            :style="getOptionStyle(q, 'True')"
                                            style="flex: 1; padding: 0.75rem; border-radius: 8px; border: 1px solid #eee; cursor: pointer;">
                                            True
                                        </button>
                                        <button @click="answerQuestion(idx, 'False')" :disabled="q.answered"
                                            :style="getOptionStyle(q, 'False')"
                                            style="flex: 1; padding: 0.75rem; border-radius: 8px; border: 1px solid #eee; cursor: pointer;">
                                            False
                                        </button>
                                    </div>
                                    <div v-if="q.type === 'fill'" style="margin-top: 0.5rem;">
                                        <input type="text" v-model="q.userInput" :disabled="q.answered"
                                            @keydown.enter="answerQuestion(idx, q.userInput)"
                                            placeholder="Type your answer..."
                                            style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                                        <button v-if="!q.answered" @click="answerQuestion(idx, q.userInput)" class="btn"
                                            style="margin-top: 0.5rem; padding: 0.5rem 1rem;">Submit</button>
                                    </div>
                                    <div v-if="q.answered" style="margin-top: 1rem; font-weight: 500;"
                                        :style="{color: q.correct ? '#15803d' : '#b91c1c'}">
                                        {{ q.correct ? 'Correct!' : 'Incorrect. The answer is ' + q.answer }}
                                    </div>
                                    <div v-if="q.answered && q.explanation"
                                        style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">
                                        {{ q.explanation }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-if="aiSidebarTab === 'chats' && (messages.length > 0 || isAiThinking)"
                            class="ai-messages-scroll" ref="chatWindow">
                            <div v-for="(msg, index) in messages" :key="index"
                                style="max-width: 800px; margin: 0 auto 2rem auto;">
                                <div v-if="msg.role === 'user'"
                                    style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                                    <div
                                        style="background: #f0f0f0; padding: 0.75rem 1rem; border-radius: 12px; font-size: 1.05rem; max-width: 80%;">
                                        {{ msg.content }}
                                    </div>
                                </div>
                                <div v-if="msg.role === 'assistant'" style="display: flex; gap: 1rem;">
                                    <div style="flex: 1;">
                                        <div class="markdown-body ai-response" v-html="renderMarkdown(msg.content)"
                                            style="font-size: 1rem; line-height: 1.7; color: #333;"></div>
                                        <img v-if="msg.image" :src="msg.image" alt="Generated image"
                                            style="max-width: 100%; border-radius: 12px; margin-top: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                                    </div>
                                </div>
                            </div>
                            <div v-if="isAiThinking" style="max-width: 800px; margin: 0 auto; padding: 1rem;">
                                <div v-if="currentToolUsed" class="tool-indicator">
                                    <i class="ph ph-gear" style="animation: spin 1s linear infinite;"></i>
                                    Used Tool: {{ currentToolUsed }}
                                </div>
                                <div class="skeleton-loader skeleton-line medium"></div>
                                <div class="skeleton-loader skeleton-line long"></div>
                            </div>
                        </div>
                        <div v-if="aiSidebarTab === 'chats' && (messages.length > 0 || isAiThinking)"
                            class="ai-input-fixed" style="display: flex; justify-content: center;">
                            <div
                                style="width: 100%; max-width: 800px; display: flex; gap: 0.5rem; background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 0.75rem;">
                                <textarea v-model="aiInput" @keydown.enter.prevent="sendAiMessage"
                                    placeholder="Ask follow-up..."
                                    style="flex: 1; border: none; outline: none; resize: none; max-height: 200px;"
                                    rows="1"></textarea>
                                <button class="chat-action-btn" @click="sendAiMessage"
                                    :disabled="isAiThinking || !aiInput.trim()">
                                    <i class="ph-fill ph-arrow-up-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'messages'"
                    style="height: 100%; display: grid; grid-template-columns: 320px 1fr; gap: 0; background: white; border-radius: 20px; overflow: hidden; border: 1px solid rgba(0,0,0,0.05); box-shadow: var(--shadow-sm);">
                    <div
                        style="border-right: 1px solid rgba(0,0,0,0.05); background: #fafafa; display: flex; flex-direction: column;">
                        <div style="padding: 1.5rem; border-bottom: 1px solid rgba(0,0,0,0.05);">
                            <h2
                                style="font-family: 'Outfit'; font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                                Messages</h2>
                            <div style="position: relative;">
                                <i class="ph ph-magnifying-glass"
                                    style="position: absolute; left: 12px; top: 12px; color: #999;"></i>
                                <input type="text" v-model="chatSearch" placeholder="Search mentors..."
                                    style="width: 100%; padding: 0.75rem 0.75rem 0.75rem 2.5rem; border: 1px solid #e0e0e0; border-radius: 10px; font-family: 'DM Sans';">
                            </div>
                        </div>
                        <div style="flex: 1; overflow-y: auto;">
                            <div v-for="chat in filteredChats" :key="chat.id" @click="selectChat(chat)"
                                class="chat-contact-item"
                                :style="{ padding: '1rem 1.5rem', cursor: 'pointer', borderBottom: '1px solid #f0f0f0', background: activeChat && activeChat.id === chat.id ? 'white' : 'transparent', borderLeft: activeChat && activeChat.id === chat.id ? '3px solid var(--text-primary)' : '3px solid transparent' }">
                                <div style="display: flex; gap: 0.75rem;">
                                    <div class="avatar-circle"
                                        style="width: 36px; height: 36px; font-size: 0.8rem; background: #222; color: white;">
                                        {{ chat.mentorName ? chat.mentorName.substring(0, 2).toUpperCase() : 'MT' }}
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="font-weight: 600;">{{ chat.mentorName }}</span>
                                            <span style="font-size: 0.75rem; color: #999;">{{
                                                formatMessageTime(chat.lastMessageTime) }}</span>
                                        </div>
                                        <div
                                            style="font-size: 0.85rem; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                            {{ chat.lastMessage }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; height: 100%;">
                        <div v-if="!activeChat"
                            style="flex: 1; display: flex; align-items: center; justify-content: center; color: #999;">
                            <p>Select a conversation to start messaging</p>
                        </div>
                        <template v-else>
                            <div
                                style="padding: 1rem 2rem; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div class="avatar-circle" style="background: #222; color: white;">
                                        {{ activeChat.mentorName ? activeChat.mentorName.substring(0, 2).toUpperCase() :
                                        'MT' }}
                                    </div>
                                    <div>
                                        <div style="font-weight: 700;">{{ activeChat.mentorName }}</div>
                                        <div style="font-size: 0.8rem; color: #22c55e;">Online</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="icon-btn" @click="startCall">
                                        <i class="ph ph-video-camera"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="messages-area"
                                style="flex: 1; padding: 2rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; background: white;">
                                <div v-for="msg in activeMessages" :key="msg.id"
                                    :style="{ alignSelf: msg.senderId === currentUser.uid ? 'flex-end' : 'flex-start', maxWidth: '65%' }">
                                    <div
                                        :style="{ background: msg.senderId === currentUser.uid ? 'var(--text-primary)' : '#f3f4f6', color: msg.senderId === currentUser.uid ? 'white' : 'var(--text-primary)', padding: '0.75rem 1rem', borderRadius: '16px', fontSize: '0.9rem', lineHeight: '1.5' }">
                                        {{ msg.text }}
                                    </div>
                                    <div :style="{textAlign: msg.senderId === currentUser.uid ? 'right' : 'left'}"
                                        style="font-size: 0.7rem; color: #999; margin-top: 4px;">
                                        {{ formatMessageTime(msg.timestamp) }}
                                    </div>
                                </div>
                            </div>
                            <div style="padding: 1.5rem 2rem; border-top: 1px solid #f0f0f0;">
                                <div
                                    style="display: flex; gap: 1rem; align-items: center; background: #f9fafb; padding: 0.75rem 1rem; border-radius: 16px; border: 1px solid #eee;">
                                    <input type="text" placeholder="Type a message..." v-model="newMessage"
                                        @keyup.enter.prevent="sendChatMessage"
                                        style="flex: 1; border: none; background: transparent; outline: none;">
                                    <button @click.prevent="sendChatMessage"
                                        style="background: var(--text-primary); border: none; width: 36px; height: 36px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                        <i class="ph ph-paper-plane-right"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
                <div v-if="activeTab === 'whiteboard'" style="height: 100%;">
                    <div class="whiteboard-container">
                        <div class="excalidraw-toolbar">
                            <button class="ex-tool" :class="{active: wbTool === 'hand'}" @click="wbTool = 'hand'"
                                title="Pan (H)"><i class="ph ph-hand"></i></button>
                            <button class="ex-tool" :class="{active: wbTool === 'pointer'}" @click="wbTool = 'pointer'"
                                title="Selection (1)"><i class="ph ph-cursor"></i></button>
                            <button class="ex-tool" :class="{active: wbTool === 'pen'}" @click="selectTool('pen')"
                                title="Pen (7)"><i class="ph ph-pencil-simple"></i></button>
                            <button class="ex-tool" :class="{active: wbTool === 'eraser'}" @click="selectTool('eraser')"
                                title="Eraser (0)"><i class="ph ph-eraser"></i></button>
                            <button class="ex-tool" :class="{active: wbTool === 'shape'}" @click="wbTool = 'shape'"
                                title="Shape (2)"><i class="ph ph-square"></i></button>
                        </div>
                        <div class="ex-options-panel" :class="{visible: showOptionsPanel}">
                            <div class="ex-color-group">
                                <div class="ex-color" style="background: #1e1e1e;"
                                    :class="{active: wbColor === '#1e1e1e'}" @click="wbColor = '#1e1e1e'"></div>
                                <div class="ex-color" style="background: #e03131;"
                                    :class="{active: wbColor === '#e03131'}" @click="wbColor = '#e03131'"></div>
                                <div class="ex-color" style="background: #1971c2;"
                                    :class="{active: wbColor === '#1971c2'}" @click="wbColor = '#1971c2'"></div>
                            </div>
                        </div>
                        <div class="ex-actions">
                            <button class="ex-action-btn" @click="clearBoard"><i class="ph ph-trash"></i></button>
                            <button class="ex-action-btn" @click="downloadBoard"><i
                                    class="ph ph-download-simple"></i></button>
                        </div>
                        <div class="canvas-area" ref="canvasArea" @mousedown="startDrawing" @mousemove="draw"
                            @mouseup="stopDrawing" @mouseleave="stopDrawing">
                            <canvas ref="drawCanvas" style="position: absolute; top: 0; left: 0;"></canvas>
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'sessions'">
                    <div class="header-area">
                        <div>
                            <div class="header-date">Call History</div>
                            <h1 class="header-title">Your Sessions</h1>
                        </div>
                    </div>
                    <div class="floating-list">
                        <div v-for="ct in callTranscripts" :key="ct.id" class="list-item"
                            style="cursor: pointer; flex-direction: column; align-items: stretch; gap: 0.75rem;"
                            @click="ct.expanded = !ct.expanded">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div class="item-left">
                                    <div class="item-icon"><i class="ph ph-video-camera"></i></div>
                                    <div>
                                        <div class="item-primary-text">{{ ct.mentorName || 'Unknown' }}</div>
                                        <div class="item-secondary-text">{{ formatSessionInfo(ct) }}</div>
                                    </div>
                                </div>
                                <i :class="ct.expanded ? 'ph ph-caret-up' : 'ph ph-caret-down'"
                                    style="color: #999;"></i>
                            </div>
                            <div v-if="ct.expanded" @click.stop
                                style="background: #f9fafb; border-radius: 12px; padding: 1.5rem;">
                                <div v-if="ct.summary">
                                    <div
                                        style="font-weight: 600; font-size: 0.9rem; margin-bottom: 0.5rem; color: #333;">
                                        Session Summary</div>
                                    <div class="markdown-body" v-html="renderMarkdown(ct.summary)"
                                        style="font-size: 0.9rem; color: #555; line-height: 1.6; margin-bottom: 1.5rem;">
                                    </div>
                                </div>
                                <div v-else-if="ct.generatingSummary"
                                    style="color: #999; font-size: 0.9rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <div class="spinner" style="width: 16px; height: 16px; border-width: 2px;"></div>
                                    Generating summary...
                                </div>
                                <div v-else style="margin-bottom: 1.5rem;">
                                    {{ generateSummary(ct) }}
                                    <span style="color: #999; font-size: 0.9rem;">Loading summary...</span>
                                </div>

                                <button class="btn" @click="analyzeSession(ct)" style="width: 100%;">
                                    <i class="ph ph-chat-circle-text" style="margin-right: 0.5rem;"></i>
                                    Chat about meeting
                                </button>
                            </div>
                        </div>
                        <div v-if="callTranscripts.length === 0"
                            style="text-align: center; color: #999; padding: 3rem;">
                            <i class="ph ph-video-camera"
                                style="font-size: 2.5rem; margin-bottom: 0.75rem; display: block;"></i>
                            No session recordings yet. Transcripts will appear here after your calls.
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'notes'" style="height: 100%;">
                    <div class="notes-layout">
                        <div class="notes-sidebar">
                            <div class="notes-sidebar-header">
                                <h3>Notes</h3>
                                <button @click="createNewNote" class="btn">
                                    <i class="ph ph-plus"></i>
                                </button>
                            </div>
                            <div class="notes-list">
                                <div v-for="note in notes" :key="note.id" class="note-item"
                                    :class="{active: activeNote && activeNote.id === note.id}"
                                    @click="selectNote(note)">
                                    <h4>{{ note.title || 'Untitled' }}</h4>
                                    <p>{{ formatDate(note.updatedAt) }}</p>
                                </div>
                                <div v-if="notes.length === 0"
                                    style="text-align: center; color: #91918e; padding: 2rem; font-size: 0.85rem;">
                                    No notes yet
                                </div>
                            </div>
                        </div>
                        <div class="notes-editor">
                            <template v-if="activeNote">
                                <div class="notes-editor-header">
                                    <input type="text" v-model="noteTitle" @input="autoSaveNote" placeholder="Untitled"
                                        style="font-family: 'Outfit'; font-size: 1.75rem;">
                                    <button @click="deleteNote(activeNote)" class="icon-btn danger" title="Delete">
                                        <i class="ph ph-trash"></i>
                                    </button>
                                </div>
                                <div class="notes-toolbar" @mousedown.prevent>
                                    <button @click="formatBlock('h1')" title="Heading 1"><b>H1</b></button>
                                    <button @click="formatBlock('h2')" title="Heading 2"><b
                                            style="font-size: 0.8em;">H2</b></button>
                                    <button @click="formatBlock('h3')" title="Heading 3"><b
                                            style="font-size: 0.7em;">H3</b></button>
                                    <div class="toolbar-sep"></div>
                                    <button @click="formatInline('bold')" title="Bold"><i
                                            class="ph-bold ph-text-b"></i></button>
                                    <button @click="formatInline('italic')" title="Italic"><i
                                            class="ph-bold ph-text-italic"></i></button>
                                    <button @click="formatInline('strikethrough')" title="Strikethrough"><i
                                            class="ph-bold ph-text-strikethrough"></i></button>
                                    <button @click="formatInline('code')" title="Inline code"><i
                                            class="ph-bold ph-code"></i></button>
                                    <div class="toolbar-sep"></div>
                                    <button @click="formatList('ul')" title="Bullet list"><i
                                            class="ph-bold ph-list-bullets"></i></button>
                                    <button @click="formatList('ol')" title="Numbered list"><i
                                            class="ph-bold ph-list-numbers"></i></button>
                                    <div class="toolbar-sep"></div>
                                    <button @click="formatBlock('blockquote')" title="Quote"><i
                                            class="ph-bold ph-quotes"></i></button>
                                    <button @click="insertDivider()" title="Divider"><i
                                            class="ph-bold ph-minus"></i></button>
                                    <button @click="insertCodeBlock()" title="Code block"><i
                                            class="ph-bold ph-code-block"></i></button>
                                </div>
                                <div class="notes-editor-content">
                                    <div class="notes-preview" contenteditable="true" ref="noteEditor"
                                        @input="handleNoteInput" @keydown="handleNoteKeydown" @paste="handleNotePaste">
                                    </div>
                                </div>
                            </template>
                            <div v-else
                                style="display: flex; align-items: center; justify-content: center; height: 100%; color: #91918e;">
                                <div style="text-align: center;">
                                    <i class="ph ph-notebook"
                                        style="font-size: 2.5rem; margin-bottom: 0.75rem; display: block;"></i>
                                    <p style="font-size: 0.9rem;">Select a note or create a new one</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-if="activeTab === 'settings'" class="settings-container">
                    <div class="page-header">
                        <h1>Settings</h1>
                        <p>Manage your account and preferences</p>
                    </div>
                    <div class="settings-layout">
                        <div class="settings-nav">
                            <div class="settings-nav-item" :class="{active: settingsSection === 'profile'}"
                                @click="settingsSection = 'profile'">
                                <i class="ph ph-user"></i> Profile
                            </div>
                            <div class="settings-nav-item" :class="{active: settingsSection === 'notifications'}"
                                @click="settingsSection = 'notifications'">
                                <i class="ph ph-bell"></i> Notifications
                            </div>
                            <div style="margin-top: auto; padding-top: 1rem;">
                                <button class="btn-outline" @click="logout"
                                    style="width: 100%; color: #ef4444; border-color: #fecaca; padding: 0.75rem;">
                                    <i class="ph ph-sign-out" style="margin-right: 0.5rem;"></i> Sign Out
                                </button>
                            </div>
                        </div>
                        <div class="settings-content">
                            <div v-if="settingsSection === 'profile'" class="settings-section">
                                <h2>Profile Information</h2>
                                <p class="section-desc">Update your personal details</p>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Display Name</label>
                                        <input type="text" v-model="profileData.displayName" placeholder="Your name">
                                    </div>
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" :value="currentUser?.email" disabled>
                                    </div>
                                    <div class="form-group">
                                        <label>Grade/Year</label>
                                        <div class="custom-select" :class="{open: dropdowns.grade}"
                                            @click.stop="toggleDropdown('grade')">
                                            <div class="custom-select-trigger">
                                                <span>{{ formatGrade(profileData.grade) }}</span>
                                                <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="#666"
                                                    stroke-width="2">
                                                    <path d="M6 9l6 6 6-6" />
                                                </svg>
                                            </div>
                                            <div v-if="dropdowns.grade" class="custom-select-dropdown">
                                                <div class="custom-select-option"
                                                    :class="{selected: profileData.grade === '9'}"
                                                    @click.stop="selectDropdown('grade', '9', 'profileData', 'grade')">
                                                    Grade 9</div>
                                                <div class="custom-select-option"
                                                    :class="{selected: profileData.grade === '10'}"
                                                    @click.stop="selectDropdown('grade', '10', 'profileData', 'grade')">
                                                    Grade 10</div>
                                                <div class="custom-select-option"
                                                    :class="{selected: profileData.grade === '11'}"
                                                    @click.stop="selectDropdown('grade', '11', 'profileData', 'grade')">
                                                    Grade 11</div>
                                                <div class="custom-select-option"
                                                    :class="{selected: profileData.grade === '12'}"
                                                    @click.stop="selectDropdown('grade', '12', 'profileData', 'grade')">
                                                    Grade 12</div>
                                                <div class="custom-select-option"
                                                    :class="{selected: profileData.grade === 'college'}"
                                                    @click.stop="selectDropdown('grade', 'college', 'profileData', 'grade')">
                                                    College</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn" @click="saveProfile">Save Changes</button>
                                </div>
                            </div>
                            <div v-if="settingsSection === 'notifications'" class="settings-section">
                                <h2>Notification Preferences</h2>
                                <p class="section-desc">Choose what notifications you receive</p>
                                <div class="notification-group">
                                    <div class="notification-item">
                                        <div class="notification-info">
                                            <h4>Session Reminders</h4>
                                            <p>Get notified before your scheduled sessions</p>
                                        </div>
                                        <label class="toggle">
                                            <input type="checkbox" v-model="settings.sessionReminders"
                                                @change="saveSettings">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-info">
                                            <h4>Message Alerts</h4>
                                            <p>Receive notifications for new messages</p>
                                        </div>
                                        <label class="toggle">
                                            <input type="checkbox" v-model="settings.messageAlerts"
                                                @change="saveSettings">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-info">
                                            <h4>Quiz Assignments</h4>
                                            <p>Get notified when a mentor assigns you a quiz</p>
                                        </div>
                                        <label class="toggle">
                                            <input type="checkbox" v-model="settings.quizAlerts" @change="saveSettings">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="notification-item">
                                        <div class="notification-info">
                                            <h4>Email Notifications</h4>
                                            <p>Receive important updates via email</p>
                                        </div>
                                        <label class="toggle">
                                            <input type="checkbox" v-model="settings.emailNotifications"
                                                @change="saveSettings">
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <div v-if="showBookingModal" class="modal-overlay" @click.self="showBookingModal = false">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Book a Session</h2>
                    <button class="modal-close" @click="showBookingModal = false"><i class="ph ph-x"></i></button>
                </div>
                <div class="form-group" style="margin-bottom: 1.25rem;">
                    <label>Select Mentor</label>
                    <div class="custom-select" :class="{open: dropdowns.mentor}" @click.stop="toggleDropdown('mentor')">
                        <div class="custom-select-trigger">
                            <span :class="{placeholder: !bookingData.mentorId}">{{ bookingData.mentorId ?
                                (assignedMentors.find(m => m.id === bookingData.mentorId)?.displayName ||
                                assignedMentors.find(m => m.id === bookingData.mentorId)?.name || 'Choose a mentor') :
                                'Choose a mentor' }}</span>
                            <svg class="chevron" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                                <path d="M6 9l6 6 6-6" />
                            </svg>
                        </div>
                        <div v-if="dropdowns.mentor" class="custom-select-dropdown">
                            <div class="custom-select-option" :class="{selected: bookingData.mentorId === ''}"
                                @click.stop="selectDropdown('mentor', '', 'bookingData', 'mentorId'); loadMentorAvailability()">
                                Choose a mentor</div>
                            <div v-for="mentor in assignedMentors" :key="mentor.id" class="custom-select-option"
                                :class="{selected: bookingData.mentorId === mentor.id}"
                                @click.stop="selectDropdown('mentor', mentor.id, 'bookingData', 'mentorId'); loadMentorAvailability()">
                                {{ mentor.displayName || mentor.name }}</div>
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 1.25rem;">
                    <label>Subject</label>
                    <input type="text" v-model="bookingData.subject" placeholder="e.g., Math, Physics">
                </div>
                <div class="form-group" style="margin-bottom: 1.25rem;">
                    <label>Date</label>
                    <input type="text" ref="bookingDatePicker" placeholder="Select date" readonly
                        style="cursor: pointer; padding: 0.7rem 1rem; border: 1px solid #e5e7eb; border-radius: 8px;">
                </div>
                <div class="form-group" style="margin-bottom: 1.25rem;" v-if="bookingData.date">
                    <label>Select Time Slot</label>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-top: 0.5rem;">
                        <div v-for="slot in availableTimeSlots" :key="slot.time"
                            @click="slot.available ? (bookingData.time = slot.time) : null" :style="{
                                padding: '0.6rem 0.5rem',
                                borderRadius: '8px',
                                textAlign: 'center',
                                fontSize: '0.85rem',
                                fontFamily: 'DM Sans, sans-serif',
                                cursor: slot.available ? 'pointer' : 'not-allowed',
                                border: bookingData.time === slot.time ? '1.5px solid #111' : '1px solid #e5e7eb',
                                background: !slot.available ? '#f3f4f6' : bookingData.time === slot.time ? '#111' : '#fafafa',
                                color: !slot.available ? '#9ca3af' : bookingData.time === slot.time ? 'white' : '#333',
                                fontWeight: bookingData.time === slot.time ? '600' : '400',
                                transition: 'all 0.15s',
                                textDecoration: !slot.available ? 'line-through' : 'none'
                            }">
                            {{ slot.time }}
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 1.25rem;">
                    <label>Session Duration</label>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                        <button v-for="dur in [30, 45, 60, 90]" :key="dur" @click="bookingData.duration = dur" :style="{
                                background: bookingData.duration === dur ? '#222' : '#f5f5f5',
                                color: bookingData.duration === dur ? 'white' : '#333',
                                border: 'none',
                                padding: '0.6rem 1rem',
                                borderRadius: '8px',
                                fontSize: '0.85rem',
                                fontWeight: '500',
                                cursor: 'pointer',
                                flex: 1
                            }">
                            {{ dur }} min
                        </button>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 1.5rem;">
                    <label>Notes (optional)</label>
                    <textarea v-model="bookingData.notes" placeholder="Topics you'd like to cover..."
                        style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; resize: vertical; min-height: 70px;"></textarea>
                </div>
                <button class="btn" @click="submitBooking" style="width: 100%;">
                    <i class="ph ph-paper-plane-tilt" style="margin-right: 0.5rem;"></i> Send Request
                </button>
            </div>
        </div>
        <div v-if="showVideoModal" class="modal-overlay"
            style="display: flex; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 9999; justify-content: center; align-items: center;">
            <div
                style="width: 90%; max-width: 1000px; height: 80%; max-height: 700px; display: flex; flex-direction: column; position: relative;">
                <div style="flex: 1; background: #1a1a1a; border-radius: 16px; overflow: hidden; position: relative;">
                    <div id="remote-video" style="width: 100%; height: 100%;"></div>
                    <div id="local-video"
                        style="position: absolute; bottom: 20px; right: 20px; width: 200px; height: 150px; background: #333; border-radius: 12px; overflow: hidden; border: 2px solid rgba(255,255,255,0.2);">
                    </div>
                    <div v-if="!remoteUser"
                        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; display: flex; flex-direction: column; align-items: center; gap: 1rem;">
                        <i class="ph ph-spinner" style="font-size: 3rem; animation: spin 1s linear infinite;"></i>
                        <p>Waiting for mentor to join...</p>
                    </div>
                </div>
                <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 1.5rem;">
                    <button @click="toggleAudio"
                        :style="{ background: audioMuted ? '#ef4444' : 'rgba(255,255,255,0.1)' }"
                        style="width: 56px; height: 56px; border-radius: 50%; border: none; color: white; font-size: 1.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        <i class="ph" :class="audioMuted ? 'ph-microphone-slash' : 'ph-microphone'"></i>
                    </button>
                    <button @click="toggleVideo"
                        :style="{ background: videoMuted ? '#ef4444' : 'rgba(255,255,255,0.1)' }"
                        style="width: 56px; height: 56px; border-radius: 50%; border: none; color: white; font-size: 1.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        <i class="ph" :class="videoMuted ? 'ph-video-camera-slash' : 'ph-video-camera'"></i>
                    </button>
                    <button @click="endCall"
                        style="width: 56px; height: 56px; border-radius: 50%; border: none; background: #ef4444; color: white; font-size: 1.25rem; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-phone-disconnect"></i>
                    </button>
                </div>
            </div>
        </div>
        <div v-if="showConfirmModal" class="modal-overlay"
            style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.4); z-index: 10001; display: flex; justify-content: center; align-items: center;"
            @click.self="showConfirmModal = false">
            <div
                style="background: white; border-radius: 16px; padding: 2rem; width: 380px; max-width: 90vw; text-align: center;">
                <i class="ph ph-warning-circle"
                    style="font-size: 2.5rem; color: #ef4444; margin-bottom: 0.75rem; display: block;"></i>
                <h3 style="font-family: 'Outfit'; font-size: 1.25rem; margin-bottom: 0.5rem;">{{ confirmTitle }}</h3>
                <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">{{ confirmMessage }}</p>
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn-outline" @click="showConfirmModal = false" style="flex: 1;">Cancel</button>
                    <button class="btn" @click="confirmModalAction" style="flex: 1; background: #ef4444;">{{
                        confirmBtnText || 'Delete' }}</button>
                </div>
            </div>
        </div>
        <div id="toast"
            :style="{ opacity: showToast ? 1 : 0, transform: showToast ? 'translateY(0)' : 'translateY(20px)' }"
            style="position: fixed; bottom: 20px; right: 20px; background: #222; color: white; padding: 12px 24px; border-radius: 12px; transition: all 0.3s; pointer-events: none; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
            {{ toastMessage }}
        </div>
    </div>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.22.0.js"></script>
    <script type="module" src="/scripts/mentee-dashboard.js"></script>
</body>

</html>